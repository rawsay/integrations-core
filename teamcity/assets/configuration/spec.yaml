name: Teamcity
files:
- name: teamcity.yaml
  options:
  - template: init_config
    options:
    - template: init_config/default
  - template: instances
    options:
    - name: server
      description: |
        Specify the server name of your teamcity instance
        Guest authentication must be on if you want the check to be able to get data
        When using the optional `basic_http_authentication` use:

         server: http://<USER>:<PASSWORD>@teamcity.<ACCOUNT_NAME>.com
      value:
        type: string
        example: http://teamcity.<ACCOUNT_NAME>.com
    - name: use_openmetrics
      description: |
        Set to true to enable OpenMetric collection from the TeamCity server's metrics endpoint.
      value:
        type: boolean
        example: false
    - name: experimental_metrics
      description: |
        Set to true to enable collection of experimental metrics.
      value:
        type: boolean
        example: true
    - name: collect_events
      description: |
        Set to true to enable collection of TeamCity build and deployment success and failure events
      value:
        type: boolean
        example: true
    - name: name
      description: |
        A custom unique name per build configuration that is shown
        in the events.
      value:
        type: string
        example: <BUILD_NAME>
    - name: build_configuration
      description: |
        This is the internal build ID of the build configuration you wish to track.
        You can find it labelled as "Build configuration ID" when editing the configuration in question.
      value:
        type: string
    - name: basic_http_authentication
      description: |
        Set to true to turn on basic http authentication.
      value:
        type: boolean
        example: false
    - name: host_affected
      description: |
        Use this parameter to override the host that is affected by this build configuration.
        Defaults to the host that the agent is running on.
      value:
        type: string
    - name: is_deployment
      description: |
        Set to true to change the event message slightly to specify that TeamCity was used to deploy something
        rather than just that a successful build happened
      value:
        type: boolean
        example: false
    - template: instances/openmetrics
      overrides:
        openmetrics_endpoint.hidden: true
        openmetrics_endpoint.required: false
  - template: logs
    example:
    - type: file
      path: /opt/teamcity/logs/teamcity-server.log
      source: teamcity
    - type: file
      path: /opt/teamcity/logs/teamcity-activities.log
      source: teamcity
    - type: file
      path: /opt/teamcity/logs/teamcity-vcs.log
      source: teamcity
    - type: file
      path: /opt/teamcity/logs/teamcity-cleanup.log
      source: teamcity
    - type: file
      path: /opt/teamcity/logs/teamcity-notifications.log
      source: teamcity
    - type: file
      path: /opt/teamcity/logs/teamcity-ws.log
      source: teamcity
